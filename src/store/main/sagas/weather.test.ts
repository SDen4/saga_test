import { put, takeEvery } from 'redux-saga/effects';

import { weatherSaga } from '../actions';
import { getWeatherData, weatherWatcher } from './weather';

import { weatherChart, weatherLoading } from '../reducers';

import { WeatherAllDataType, WeatherChartItem } from 'model/weather';

const resMock: WeatherAllDataType = {
  latitude: 56.875,
  longitude: 60.625,
  generationtime_ms: 0.30303001403808594,
  utc_offset_seconds: 0,
  timezone: 'GMT',
  timezone_abbreviation: 'GMT',
  elevation: 254.0,
  hourly_units: { time: 'iso8601', temperature_2m: 'Â°C' },
  hourly: {
    time: [
      '2022-11-26T00:00',
      '2022-11-26T01:00',
      '2022-11-26T02:00',
      '2022-11-26T03:00',
      '2022-11-26T04:00',
      '2022-11-26T05:00',
      '2022-11-26T06:00',
      '2022-11-26T07:00',
      '2022-11-26T08:00',
      '2022-11-26T09:00',
      '2022-11-26T10:00',
      '2022-11-26T11:00',
      '2022-11-26T12:00',
      '2022-11-26T13:00',
      '2022-11-26T14:00',
      '2022-11-26T15:00',
      '2022-11-26T16:00',
      '2022-11-26T17:00',
      '2022-11-26T18:00',
      '2022-11-26T19:00',
      '2022-11-26T20:00',
      '2022-11-26T21:00',
      '2022-11-26T22:00',
      '2022-11-26T23:00',
      '2022-11-27T00:00',
      '2022-11-27T01:00',
      '2022-11-27T02:00',
      '2022-11-27T03:00',
      '2022-11-27T04:00',
      '2022-11-27T05:00',
      '2022-11-27T06:00',
      '2022-11-27T07:00',
      '2022-11-27T08:00',
      '2022-11-27T09:00',
      '2022-11-27T10:00',
      '2022-11-27T11:00',
      '2022-11-27T12:00',
      '2022-11-27T13:00',
      '2022-11-27T14:00',
      '2022-11-27T15:00',
      '2022-11-27T16:00',
      '2022-11-27T17:00',
      '2022-11-27T18:00',
      '2022-11-27T19:00',
      '2022-11-27T20:00',
      '2022-11-27T21:00',
      '2022-11-27T22:00',
      '2022-11-27T23:00',
      '2022-11-28T00:00',
      '2022-11-28T01:00',
      '2022-11-28T02:00',
      '2022-11-28T03:00',
      '2022-11-28T04:00',
      '2022-11-28T05:00',
      '2022-11-28T06:00',
      '2022-11-28T07:00',
      '2022-11-28T08:00',
      '2022-11-28T09:00',
      '2022-11-28T10:00',
      '2022-11-28T11:00',
      '2022-11-28T12:00',
      '2022-11-28T13:00',
      '2022-11-28T14:00',
      '2022-11-28T15:00',
      '2022-11-28T16:00',
      '2022-11-28T17:00',
      '2022-11-28T18:00',
      '2022-11-28T19:00',
      '2022-11-28T20:00',
      '2022-11-28T21:00',
      '2022-11-28T22:00',
      '2022-11-28T23:00',
      '2022-11-29T00:00',
      '2022-11-29T01:00',
      '2022-11-29T02:00',
      '2022-11-29T03:00',
      '2022-11-29T04:00',
      '2022-11-29T05:00',
      '2022-11-29T06:00',
      '2022-11-29T07:00',
      '2022-11-29T08:00',
      '2022-11-29T09:00',
      '2022-11-29T10:00',
      '2022-11-29T11:00',
      '2022-11-29T12:00',
      '2022-11-29T13:00',
      '2022-11-29T14:00',
      '2022-11-29T15:00',
      '2022-11-29T16:00',
      '2022-11-29T17:00',
      '2022-11-29T18:00',
      '2022-11-29T19:00',
      '2022-11-29T20:00',
      '2022-11-29T21:00',
      '2022-11-29T22:00',
      '2022-11-29T23:00',
      '2022-11-30T00:00',
      '2022-11-30T01:00',
      '2022-11-30T02:00',
      '2022-11-30T03:00',
      '2022-11-30T04:00',
      '2022-11-30T05:00',
      '2022-11-30T06:00',
      '2022-11-30T07:00',
      '2022-11-30T08:00',
      '2022-11-30T09:00',
      '2022-11-30T10:00',
      '2022-11-30T11:00',
      '2022-11-30T12:00',
      '2022-11-30T13:00',
      '2022-11-30T14:00',
      '2022-11-30T15:00',
      '2022-11-30T16:00',
      '2022-11-30T17:00',
      '2022-11-30T18:00',
      '2022-11-30T19:00',
      '2022-11-30T20:00',
      '2022-11-30T21:00',
      '2022-11-30T22:00',
      '2022-11-30T23:00',
      '2022-12-01T00:00',
      '2022-12-01T01:00',
      '2022-12-01T02:00',
      '2022-12-01T03:00',
      '2022-12-01T04:00',
      '2022-12-01T05:00',
      '2022-12-01T06:00',
      '2022-12-01T07:00',
      '2022-12-01T08:00',
      '2022-12-01T09:00',
      '2022-12-01T10:00',
      '2022-12-01T11:00',
      '2022-12-01T12:00',
      '2022-12-01T13:00',
      '2022-12-01T14:00',
      '2022-12-01T15:00',
      '2022-12-01T16:00',
      '2022-12-01T17:00',
      '2022-12-01T18:00',
      '2022-12-01T19:00',
      '2022-12-01T20:00',
      '2022-12-01T21:00',
      '2022-12-01T22:00',
      '2022-12-01T23:00',
      '2022-12-02T00:00',
      '2022-12-02T01:00',
      '2022-12-02T02:00',
      '2022-12-02T03:00',
      '2022-12-02T04:00',
      '2022-12-02T05:00',
      '2022-12-02T06:00',
      '2022-12-02T07:00',
      '2022-12-02T08:00',
      '2022-12-02T09:00',
      '2022-12-02T10:00',
      '2022-12-02T11:00',
      '2022-12-02T12:00',
      '2022-12-02T13:00',
      '2022-12-02T14:00',
      '2022-12-02T15:00',
      '2022-12-02T16:00',
      '2022-12-02T17:00',
      '2022-12-02T18:00',
      '2022-12-02T19:00',
      '2022-12-02T20:00',
      '2022-12-02T21:00',
      '2022-12-02T22:00',
      '2022-12-02T23:00',
    ],
    temperature_2m: [
      -22.8, -23.1, -23.9, -24.2, -23.8, -23.3, -22.2, -21.2, -20.5, -20.0,
      -19.7, -19.7, -20.1, -20.3, -20.3, -20.3, -20.5, -20.8, -21.2, -21.5,
      -21.6, -21.7, -22.1, -22.3, -22.6, -23.0, -23.2, -23.4, -23.6, -23.4,
      -22.1, -20.2, -18.5, -17.6, -17.3, -17.4, -17.9, -18.1, -18.3, -18.6,
      -18.9, -19.2, -19.4, -19.7, -20.0, -20.2, -20.4, -20.7, -21.0, -21.2,
      -21.5, -22.0, -22.6, -22.6, -21.3, -19.5, -18.3, -17.8, -17.9, -18.7,
      -19.8, -20.6, -21.1, -21.5, -21.9, -22.2, -22.6, -22.9, -23.2, -23.4,
      -23.6, -23.8, -24.0, -24.3, -24.6, -24.8, -24.8, -24.7, -23.8, -22.1,
      -19.8, -17.7, -17.7, -18.4, -19.6, -20.1, -20.7, -21.6, -22.3, -23.2,
      -24.0, -24.4, -24.6, -24.7, -24.4, -24.0, -23.3, -22.7, -22.0, -21.2,
      -20.9, -20.6, -20.0, -18.8, -17.4, -16.1, -16.1, -16.7, -17.5, -18.1,
      -18.9, -19.8, -20.5, -21.1, -21.8, -22.9, -23.2, -23.6, -23.8, -23.9,
      -24.0, -24.2, -24.3, -24.3, -24.2, -24.0, -23.4, -22.1, -20.5, -19.0,
      -19.0, -19.7, -20.6, -21.0, -21.4, -21.8, -22.0, -22.2, -22.3, -22.3,
      -22.3, -22.3, -22.4, -22.5, -22.5, -22.4, -22.2, -21.8, -21.5, -21.1,
      -20.2, -19.0, -17.6, -16.4, -16.7, -17.6, -18.9, -19.8, -20.7, -21.8,
      -22.5, -23.1, -23.7, -24.1, -24.4, -24.6, -24.8, -24.9,
    ],
  },
};

const chartDataMock = [
  { name: '2022-11-26T00:00', temp: -22.8 },
  { name: '2022-11-26T01:00', temp: -23.1 },
  { name: '2022-11-26T02:00', temp: -23.9 },
  { name: '2022-11-26T03:00', temp: -24.2 },
  { name: '2022-11-26T04:00', temp: -23.8 },
  { name: '2022-11-26T05:00', temp: -23.3 },
  { name: '2022-11-26T06:00', temp: -22.2 },
  { name: '2022-11-26T07:00', temp: -21.2 },
  { name: '2022-11-26T08:00', temp: -20.5 },
  { name: '2022-11-26T09:00', temp: -20 },
  { name: '2022-11-26T10:00', temp: -19.7 },
  { name: '2022-11-26T11:00', temp: -19.7 },
  { name: '2022-11-26T12:00', temp: -20.1 },
  { name: '2022-11-26T13:00', temp: -20.3 },
  { name: '2022-11-26T14:00', temp: -20.3 },
  { name: '2022-11-26T15:00', temp: -20.3 },
  { name: '2022-11-26T16:00', temp: -20.5 },
  { name: '2022-11-26T17:00', temp: -20.8 },
  { name: '2022-11-26T18:00', temp: -21.2 },
  { name: '2022-11-26T19:00', temp: -21.5 },
  { name: '2022-11-26T20:00', temp: -21.6 },
  { name: '2022-11-26T21:00', temp: -21.7 },
  { name: '2022-11-26T22:00', temp: -22.1 },
  { name: '2022-11-26T23:00', temp: -22.3 },
  { name: '2022-11-27T00:00', temp: -22.6 },
  { name: '2022-11-27T01:00', temp: -23 },
  { name: '2022-11-27T02:00', temp: -23.2 },
  { name: '2022-11-27T03:00', temp: -23.4 },
  { name: '2022-11-27T04:00', temp: -23.6 },
  { name: '2022-11-27T05:00', temp: -23.4 },
  { name: '2022-11-27T06:00', temp: -22.1 },
  { name: '2022-11-27T07:00', temp: -20.2 },
  { name: '2022-11-27T08:00', temp: -18.5 },
  { name: '2022-11-27T09:00', temp: -17.6 },
  { name: '2022-11-27T10:00', temp: -17.3 },
  { name: '2022-11-27T11:00', temp: -17.4 },
  { name: '2022-11-27T12:00', temp: -17.9 },
  { name: '2022-11-27T13:00', temp: -18.1 },
  { name: '2022-11-27T14:00', temp: -18.3 },
  { name: '2022-11-27T15:00', temp: -18.6 },
  { name: '2022-11-27T16:00', temp: -18.9 },
  { name: '2022-11-27T17:00', temp: -19.2 },
  { name: '2022-11-27T18:00', temp: -19.4 },
  { name: '2022-11-27T19:00', temp: -19.7 },
  { name: '2022-11-27T20:00', temp: -20 },
  { name: '2022-11-27T21:00', temp: -20.2 },
  { name: '2022-11-27T22:00', temp: -20.4 },
  { name: '2022-11-27T23:00', temp: -20.7 },
  { name: '2022-11-28T00:00', temp: -21 },
  { name: '2022-11-28T01:00', temp: -21.2 },
  { name: '2022-11-28T02:00', temp: -21.5 },
  { name: '2022-11-28T03:00', temp: -22 },
  { name: '2022-11-28T04:00', temp: -22.6 },
  { name: '2022-11-28T05:00', temp: -22.6 },
  { name: '2022-11-28T06:00', temp: -21.3 },
  { name: '2022-11-28T07:00', temp: -19.5 },
  { name: '2022-11-28T08:00', temp: -18.3 },
  { name: '2022-11-28T09:00', temp: -17.8 },
  { name: '2022-11-28T10:00', temp: -17.9 },
  { name: '2022-11-28T11:00', temp: -18.7 },
  { name: '2022-11-28T12:00', temp: -19.8 },
  { name: '2022-11-28T13:00', temp: -20.6 },
  { name: '2022-11-28T14:00', temp: -21.1 },
  { name: '2022-11-28T15:00', temp: -21.5 },
  { name: '2022-11-28T16:00', temp: -21.9 },
  { name: '2022-11-28T17:00', temp: -22.2 },
  { name: '2022-11-28T18:00', temp: -22.6 },
  { name: '2022-11-28T19:00', temp: -22.9 },
  { name: '2022-11-28T20:00', temp: -23.2 },
  { name: '2022-11-28T21:00', temp: -23.4 },
  { name: '2022-11-28T22:00', temp: -23.6 },
  { name: '2022-11-28T23:00', temp: -23.8 },
  { name: '2022-11-29T00:00', temp: -24 },
  { name: '2022-11-29T01:00', temp: -24.3 },
  { name: '2022-11-29T02:00', temp: -24.6 },
  { name: '2022-11-29T03:00', temp: -24.8 },
  { name: '2022-11-29T04:00', temp: -24.8 },
  { name: '2022-11-29T05:00', temp: -24.7 },
  { name: '2022-11-29T06:00', temp: -23.8 },
  { name: '2022-11-29T07:00', temp: -22.1 },
  { name: '2022-11-29T08:00', temp: -19.8 },
  { name: '2022-11-29T09:00', temp: -17.7 },
  { name: '2022-11-29T10:00', temp: -17.7 },
  { name: '2022-11-29T11:00', temp: -18.4 },
  { name: '2022-11-29T12:00', temp: -19.6 },
  { name: '2022-11-29T13:00', temp: -20.1 },
  { name: '2022-11-29T14:00', temp: -20.7 },
  { name: '2022-11-29T15:00', temp: -21.6 },
  { name: '2022-11-29T16:00', temp: -22.3 },
  { name: '2022-11-29T17:00', temp: -23.2 },
  { name: '2022-11-29T18:00', temp: -24 },
  { name: '2022-11-29T19:00', temp: -24.4 },
  { name: '2022-11-29T20:00', temp: -24.6 },
  { name: '2022-11-29T21:00', temp: -24.7 },
  { name: '2022-11-29T22:00', temp: -24.4 },
  { name: '2022-11-29T23:00', temp: -24 },
  { name: '2022-11-30T00:00', temp: -23.3 },
  { name: '2022-11-30T01:00', temp: -22.7 },
  { name: '2022-11-30T02:00', temp: -22 },
  { name: '2022-11-30T03:00', temp: -21.2 },
  { name: '2022-11-30T04:00', temp: -20.9 },
  { name: '2022-11-30T05:00', temp: -20.6 },
  { name: '2022-11-30T06:00', temp: -20 },
  { name: '2022-11-30T07:00', temp: -18.8 },
  { name: '2022-11-30T08:00', temp: -17.4 },
  { name: '2022-11-30T09:00', temp: -16.1 },
  { name: '2022-11-30T10:00', temp: -16.1 },
  { name: '2022-11-30T11:00', temp: -16.7 },
  { name: '2022-11-30T12:00', temp: -17.5 },
  { name: '2022-11-30T13:00', temp: -18.1 },
  { name: '2022-11-30T14:00', temp: -18.9 },
  { name: '2022-11-30T15:00', temp: -19.8 },
  { name: '2022-11-30T16:00', temp: -20.5 },
  { name: '2022-11-30T17:00', temp: -21.1 },
  { name: '2022-11-30T18:00', temp: -21.8 },
  { name: '2022-11-30T19:00', temp: -22.9 },
  { name: '2022-11-30T20:00', temp: -23.2 },
  { name: '2022-11-30T21:00', temp: -23.6 },
  { name: '2022-11-30T22:00', temp: -23.8 },
  { name: '2022-11-30T23:00', temp: -23.9 },
  { name: '2022-12-01T00:00', temp: -24 },
  { name: '2022-12-01T01:00', temp: -24.2 },
  { name: '2022-12-01T02:00', temp: -24.3 },
  { name: '2022-12-01T03:00', temp: -24.3 },
  { name: '2022-12-01T04:00', temp: -24.2 },
  { name: '2022-12-01T05:00', temp: -24 },
  { name: '2022-12-01T06:00', temp: -23.4 },
  { name: '2022-12-01T07:00', temp: -22.1 },
  { name: '2022-12-01T08:00', temp: -20.5 },
  { name: '2022-12-01T09:00', temp: -19 },
  { name: '2022-12-01T10:00', temp: -19 },
  { name: '2022-12-01T11:00', temp: -19.7 },
  { name: '2022-12-01T12:00', temp: -20.6 },
  { name: '2022-12-01T13:00', temp: -21 },
  { name: '2022-12-01T14:00', temp: -21.4 },
  { name: '2022-12-01T15:00', temp: -21.8 },
  { name: '2022-12-01T16:00', temp: -22 },
  { name: '2022-12-01T17:00', temp: -22.2 },
  { name: '2022-12-01T18:00', temp: -22.3 },
  { name: '2022-12-01T19:00', temp: -22.3 },
  { name: '2022-12-01T20:00', temp: -22.3 },
  { name: '2022-12-01T21:00', temp: -22.3 },
  { name: '2022-12-01T22:00', temp: -22.4 },
  { name: '2022-12-01T23:00', temp: -22.5 },
  { name: '2022-12-02T00:00', temp: -22.5 },
  { name: '2022-12-02T01:00', temp: -22.4 },
  { name: '2022-12-02T02:00', temp: -22.2 },
  { name: '2022-12-02T03:00', temp: -21.8 },
  { name: '2022-12-02T04:00', temp: -21.5 },
  { name: '2022-12-02T05:00', temp: -21.1 },
  { name: '2022-12-02T06:00', temp: -20.2 },
  { name: '2022-12-02T07:00', temp: -19 },
  { name: '2022-12-02T08:00', temp: -17.6 },
  { name: '2022-12-02T09:00', temp: -16.4 },
  { name: '2022-12-02T10:00', temp: -16.7 },
  { name: '2022-12-02T11:00', temp: -17.6 },
  { name: '2022-12-02T12:00', temp: -18.9 },
  { name: '2022-12-02T13:00', temp: -19.8 },
  { name: '2022-12-02T14:00', temp: -20.7 },
  { name: '2022-12-02T15:00', temp: -21.8 },
  { name: '2022-12-02T16:00', temp: -22.5 },
  { name: '2022-12-02T17:00', temp: -23.1 },
  { name: '2022-12-02T18:00', temp: -23.7 },
  { name: '2022-12-02T19:00', temp: -24.1 },
  { name: '2022-12-02T20:00', temp: -24.4 },
  { name: '2022-12-02T21:00', temp: -24.6 },
  { name: '2022-12-02T22:00', temp: -24.8 },
  { name: '2022-12-02T23:00', temp: -24.9 },
] as WeatherChartItem[];

describe('getWeatherData', () => {
  it('should be success', () => {
    const gen = getWeatherData();

    gen.next();

    // @ts-ignore
    expect(gen.next(resMock).value).toEqual(chartDataMock);

    // @ts-ignore
    expect(gen.next(chartDataMock).value).toEqual(
      put(weatherChart(chartDataMock)),
    );

    expect(gen.next().value).toEqual(put(weatherLoading(false)));

    expect(gen.next().done).toBeTruthy();
  });

  it('should be error', () => {
    const gen = getWeatherData();

    gen.next();

    try {
      throw new Error('OLOLO TROLO');
    } catch (error) {
      // @ts-ignore
      expect(error.message).toEqual('OLOLO TROLO');
    }

    expect(gen.next().value).toEqual(put(weatherLoading(false)));

    expect(gen.next().done).toBeTruthy();
  });
});

describe('weatherWatcher', () => {
  it('should be or not should be', () => {
    const gen = weatherWatcher();

    expect(gen.next().value).toEqual(takeEvery(weatherSaga, getWeatherData));
  });
});
